# Database Schema

This document captures the relational data model for the Job Management service.  
All tables are defined via SQLAlchemy models (see `app/models/`) using the declarative base in `app/db/base.py`.

The service persists data in SQLite by default (`Settings.database_url`), but the schema is engine-agnostic.

---

## Entity Relationship Overview

- **users** (`User`)
  - Primary key: `id`
  - Represents workers registered in the system
  - One-to-many relationship with `user_jobs`

- **jobs** (`Job`)
  - Primary key: `id`
  - Represents job postings
  - One-to-many relationship with `user_jobs`

- **user_jobs** (`UserJob`)
  - Composite primary key: (`userId`, `jobId`)
  - Join table capturing a user's status for a given job
  - References `users.id` and `jobs.id`

```
users (1) —— (∞) user_jobs (∞) —— (1) jobs
```

---

## Tables

### `users`
Defined in `app/models/user.py`

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| `id` | `Integer` | Primary Key, Indexed | Worker identifier assigned in seed data |
| `name` | `String(100)` | Not Null | User's full name |
| `city` | `String(100)` | Not Null | Home city for filtering jobs |

Relationships:
- `user_jobs`: backref from `UserJob.user`; list of job associations for the user.

### `jobs`
Defined in `app/models/job.py`

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| `id` | `Integer` | Primary Key, Indexed | Job identifier |
| `jobTitle` | `String(200)` | Not Null | Public job title |
| `wage` | `Float` | Not Null | Monthly wage (rupees) |
| `city` | `String(100)` | Not Null | Job location |
| `gender` | `String(50)` | Not Null | Gender preference (`Any`, `Male`, `Female`) |
| `audioScript` | `Text` | Not Null | Hindi narration script generated by `app/services/audio.py` |
| `status` | `String(20)` | Default `"open"` | Enumerated: `open`, `closed` |

Relationships:
- `user_jobs`: backref from `UserJob.job`; list of user associations for the job.

### `user_jobs`
Defined in `app/models/user_job.py`

| Column | Type | Constraints | Notes |
|--------|------|-------------|-------|
| `userId` | `Integer` | Primary Key, FK → `users.id` | Worker reference |
| `jobId` | `Integer` | Primary Key, FK → `jobs.id` | Job reference |
| `status` | `String(20)` | Not Null | Values: `applied`, `rejected`, `pending`, `closed` |

Relationships:
- `user`: `relationship("User", backref="user_jobs")`
- `job`: `relationship("Job", backref="user_jobs")`

---

## Seeds & Initialization

- Tables are created on startup via `Base.metadata.create_all(bind=engine)` in `app/main.py`.
- Initial data is provided by `app/seed.py`:
  - Populates 5 users, 8 jobs, and example `user_jobs` statuses.
  - Audio scripts are generated with `generate_hindi_audio_script` from `app/services/audio.py`.

---

## Migration Considerations

- Because SQLite is used by default, foreign-key enforcement requires enabling `PRAGMA foreign_keys=ON` if needed for cascading deletes. Current schema assumes application-level enforcement.
- For production use on PostgreSQL/MySQL, update `Settings.database_url` and run migrations using a tool like Alembic. The declarative models are compatible without modification.
- Add enumerations (SQL constraints) for `jobs.status` and `user_jobs.status` if stricter validation is required by the target RDBMS.

---

## References

- `app/db/base.py`: Declarative base definition.
- `app/db/session.py`: Engine and session configuration.
- `app/models/`: SQLAlchemy model implementations.
- `app/services/audio.py`: Logic populating `jobs.audioScript`.


